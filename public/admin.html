<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TekeTeke - Admin Console</title>
  <style>
    :root{
      --brand:#0ea5e9; --ink:#0b0b0c; --bg:#f6fbff; --panel:#fff; --muted:#6b7280;
      --ok:#065f46; --bad:#b91c1c; --border:#e5e7eb; --sidebar:#0b1220; --sidebarInk:#cbd5e1;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);font-family:system-ui,Arial,sans-serif;color:var(--ink);display:flex}
    .sidebar{width:240px;background:var(--sidebar);color:var(--sidebarInk);display:flex;flex-direction:column}
    .brand{padding:16px 18px;border-bottom:1px solid #0f172a;font-weight:800;color:#fff}
    .nav{padding:10px}
    .nav button{width:100%;text-align:left;padding:10px 12px;border-radius:10px;border:1px solid transparent;background:transparent;color:var(--sidebarInk);cursor:pointer}
    .nav button.active,.nav button:hover{background:#111827;color:#fff;border-color:#1f2937}
    .content{flex:1;display:flex;flex-direction:column;min-width:0}
    header{background:var(--panel);border-bottom:1px solid var(--border);padding:12px 16px;display:flex;align-items:center;gap:12px;justify-content:space-between}
    main{max-width:1100px;margin:18px auto;padding:0 16px;width:100%}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 4px 16px rgba(2,132,199,.06)}
    h2{margin:0 0 10px}
    .muted{color:var(--muted)}
    form{display:grid;gap:10px;margin-top:8px}
    .row{display:grid;gap:12px}
    @media(min-width:720px){ .row{grid-template-columns:1fr 1fr} }
    input,select,button{padding:10px 12px;border-radius:10px;border:1px solid var(--border)}
    button.primary{background:var(--brand);color:#fff;border:none;font-weight:600;cursor:pointer}
    button.secondary{background:#111827;color:#fff;border:none;cursor:pointer}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .danger{background:#b91c1c;color:#fff;border:none}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left;vertical-align:middle}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#e0f2fe;color:#075985;font-size:.85rem}
    .pill-success{background:#dcfce7;color:#166534}
    .pill-failed{background:#fee2e2;color:#991b1b}
    .pill-pending,.pill-timeout{background:#fef3c7;color:#92400e}
    .toast{position:fixed;right:16px;top:16px;background:#111827;color:#fff;padding:10px 14px;border-radius:12px;opacity:0;transition:opacity .2s, transform .2s;transform:translateY(-10px);z-index:1000}
    .toast.show{opacity:1;transform:translateY(0)}
    .section{display:none}
    .section.active{display:block}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
    .copybtn{margin-left:8px;padding:6px 10px;border-radius:8px;background:#111827;color:#fff;border:none;cursor:pointer;font-size:.85rem}
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="brand">TekeTeke Admin</div>
    <div class="nav">
      <button id="nav-register" data-section="register" class="active" type="button">Register New Matatu</button>
      <button id="nav-edit" data-section="edit" type="button">Edit Existing Matatu</button>
      <button id="nav-list" data-section="list" type="button">Matatu List</button>
      <button id="nav-trans" data-section="transactions" type="button">Transactions</button>
      <hr style="border:0;border-top:1px solid #1f2937;margin:10px 0">
      <button id="nav-session" data-section="session" type="button">Session</button>
    </div>
  </aside>

  <div class="content">
    <header>
      <div><strong>Admin Console</strong> <span class="muted">&bull; matatus only</span></div>
      <button id="btn-logout" class="secondary" type="button" data-action="logout">Logout</button>
    </header>

    <main>
      <section id="section-register" class="section active">
        <div class="card">
          <h2>Register New Matatu</h2>
          <div class="muted">Plate + Till are required. USSD is allocated automatically.</div>
          <form id="form-register">
            <div class="row">
              <input id="new_plate" placeholder="Number plate (e.g., KDA 123A)" required />
              <input id="new_name" placeholder="Alias name (optional)" />
            </div>
            <div class="row">
              <input id="new_till" placeholder="Till number" required />
              <input id="new_sacco" placeholder="SACCO name (optional)" />
            </div>
            <button class="primary" type="submit">Create / Update</button>
          </form>
        </div>
      </section>

      <section id="section-edit" class="section">
        <div class="card">
          <h2>Edit Existing Matatu</h2>
          <div class="toolbar">
            <input id="edit_search" placeholder="Search by plate..." />
            <button id="btn-edit-search" class="secondary" type="button">Search</button>
          </div>
          <div id="edit_result" class="muted">Search to load a matatu...</div>
        </div>
      </section>

      <section id="section-list" class="section">
        <div class="card">
          <div class="toolbar">
            <h2 style="margin:0">Matatu List</h2>
            <button id="btn-list-refresh" class="secondary" type="button">Refresh</button>
            <input id="list_filter" placeholder="Filter by plate..." />
          </div>
          <table id="tbl">
            <thead>
              <tr>
                <th>ID</th>
                <th>Plate</th>
                <th>Till</th>
                <th>USSD</th>
                <th>Dial</th>
                <th>Success</th>
                <th>Last Tx</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section id="section-transactions" class="section">
        <div class="card">
          <h2>Transactions</h2>
          <div class="toolbar">
            <select id="tx_matatu">
              <option value="">All matatus</option>
            </select>
            <input id="tx_plate" placeholder="Search by plate (optional)" />
            <input id="tx_from" type="date" />
            <input id="tx_to" type="date" />
            <button id="btn-tx-load" class="secondary" type="button">Load</button>
            <button id="btn-tx-reset" class="secondary" type="button">Reset</button>
          </div>
          <div class="muted" id="tx_summary" style="display:none"></div>
          <div class="muted" id="tx_hint">Enter filters above and select Load to view recent transactions.</div>
          <table id="tx_tbl" style="display:none">
            <thead>
              <tr>
                <th>Time</th>
                <th>Plate</th>
                <th>MSISDN</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Receipt</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section id="section-session" class="section">
        <div class="card">
          <h2>Session</h2>
          <div class="muted">You are signed in. Use the button below to end the session.</div>
          <div class="actions" style="margin-top:8px">
            <button id="btn-logout-2" class="secondary" type="button" data-action="logout">Logout</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="toast" class="toast">Saved</div>
  <script src="./js/admin.js" defer></script>
</body>
</html>
